<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>You&#x27;re Projecting - Geospatial Rust</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/css/style.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded affix "><li class="part-title">Lessons</li><li class="chapter-item expanded "><a href="youre-projecting.html" class="active"><strong aria-hidden="true">2.</strong> You're Projecting</a></li><li class="chapter-item expanded "><a href="feature-creek.html"><strong aria-hidden="true">3.</strong> Feature Creek</a></li><li class="chapter-item expanded "><a href="join-the-party.html"><strong aria-hidden="true">4.</strong> Join the Party</a></li><li class="chapter-item expanded affix "><li class="part-title">About This Book</li><li class="chapter-item expanded "><a href="contact.html"><strong aria-hidden="true">5.</strong> Contact the Authors</a></li><li class="chapter-item expanded "><a href="license.html"><strong aria-hidden="true">6.</strong> License</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Geospatial Rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="youre-projecting"><a class="header" href="#youre-projecting">You’re Projecting</a></h1>
<p>Just like any good argument, the best way to start spatial analysis is by projecting your points.</p>
<p>Speaking of good arguments, <em>almost</em> everyone agrees at this point that the earth is a three-dimensional (and slightly smooshed) sphere. However, many spatial algorithms operate under the rustic assumptions of two-dimensional <a href="https://en.wikipedia.org/wiki/Euclidean_geometry">euclidean geometry</a>. When your input is defined in terms of latitude and longitude, the first step is to flatten (or “project”) it onto 2D space.</p>
<h2 id="in-depth-perception"><a class="header" href="#in-depth-perception">In-depth Perception</a></h2>
<p>There are lots of ways to flatten a 3D thing into a 2D space, but this process inherently introduces some distortion (like an orange getting smashed in your backpack). Choosing the best possible “projection” for a given scenario is part of the art of being a geospatial analyst.</p>
<div class="side-by-side">
  <div>
    <img src="images/mercator-projection.jpg" alt="A map of the earth as projected to a rectangle with the Mercator projection." />
    <center><strong>Mercator</strong></center>
  </div>
<div>
    <img src="images/gnomonic-projection.jpg" alt="A map of the northern hemisphere of earth centered on the North Pole, projected to a circle with a gnomonic projection" />
    <center><strong>Gnomonic</strong></center>
  </div>
</div>
<p>For applications spanning the globe, <a href="https://en.wikipedia.org/wiki/Mercator_projection">the mercator projection</a> is a common projection that minimizes distortion for most of the inhabited planet. However, if you’re focused on relative distance from a particular point, a <a href="https://en.wikipedia.org/wiki/Gnomonic_projection">gnomonic projection</a> might be a better choice.</p>
<p>If your work is more local in nature, you can use a projection method that is finely tuned for high accuracy within a relatively small and specific geographic area like <a href="https://www.conservation.ca.gov/cgs/rgm/state-plane-coordinate-system#zone5">Zone 5 in Southern California</a>, but if you try to use that same projection for something in <a href="https://en.wikipedia.org/wiki/New_York_City">New York</a> (or, <em>alas and alack</em>, <a href="https://en.wikipedia.org/wiki/York">old York</a>) your results will be way off!</p>
<p>Everything about this would be easier if the flat-earthers were right, but fortunately there are several well-rounded tools for our mostly-round earth.</p>
<h2 id="co-dependency"><a class="header" href="#co-dependency">Co-Dependency</a></h2>
<p>Our first group project(ion) will require some new dependencies.</p>
<p>The <a href="https://proj.org">PROJ</a> coordinate transformation software has been helping people solve geospatial problems since the late 1970’s. In addition to its longevity, it also stands out for its accuracy and speed. The <a href="https://crates.io/crates/proj">proj crate</a> wraps and extends PROJ to make it feel right at home in your Rust application.</p>
<p>For its part, <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry">well-known text</a> (WKT) is a very (sigh) well-known way of representing geometry as text, and the <a href="https://crates.io/crates/wkt">wkt crate</a> adds read and write support for WKT to Rust.</p>
<p>Finally, we’ll be using the <a href="https://crates.io/crates/geo">geo crate</a> (a collection of geometry types and algorithms) to do some analysis.</p>
<p>Let’s add these dependencies to our <code>Cargo.toml</code> file and get started:</p>
<pre><code class="language-toml ignore">[dependencies]
geo = &quot;0.21.0&quot;
proj = &quot;0.27.0&quot;
wkt = &quot;0.10.3&quot;
</code></pre>
<p>OK, now let’s look for a body of water and dive right in.</p>
<p><img src="images/ivanhoe-point.png" alt="Point in the center of the Ivanhoe reservoir in Los Angeles" /></p>
<p>This is the Ivanhoe reservoir in Los Angeles. Named after Sir Walter Scott’s <em>Ivanhoe</em>, a stirring tale of romance and chivalry first published in 1819…</p>
<h3 id="just-get-to-the-point"><a class="header" href="#just-get-to-the-point">Just Get to the Point</a></h3>
<p>OK OK OK. We can use the <code>wkt</code> crate to create a <code>geo</code> geometry from the text representation of this point in the center of the water.</p>
<header class="codeblock-header">Parse WKT</header>
<pre><code class="language-rust">use geo::Point;
use wkt::TryFromWkt;

let wkt_string = &quot;POINT(-118.265429 34.103175)&quot;;
let mut point: Point = Point::try_from_wkt_str(wkt_string).unwrap();
assert_eq!(point.x(), -118.265429);
assert_eq!(point.y(), 34.103175);
</code></pre>
<div class="callout rust-callout">
<h3 id="personality-traits"><a class="header" href="#personality-traits">Personality Traits</a></h3>
<p>Let’s focus on this bit of code from the example above: <code>Point::try_from_wkt_str</code>.</p>
<p>The <a href="https://docs.rs/geo/latest/geo/struct.Point.html"><code>Point</code></a> type, from the <strong><code>geo</code></strong> crate, calls the <a href="https://docs.rs/wkt/latest/wkt/trait.TryFromWkt.html"><code>try_from_wkt_str</code></a> method, from the <strong><code>wkt</code></strong> crate. Depending on your personality and background, this kind of cross-library interaction may feel either completely horrifying or utterly unremarkable. Many languages, like C++ or Java, don’t really support adding methods to existing types like this, but more dynamic languages, like Ruby or Python, let you easily do all kinds of fun things like replacing or adding methods at runtime.</p>
<p>However, ultimately you reap what you sow. Unintentionally clobbering some existing method definition that was defined in a third-party module can quickly make “fun things” feel decidedly less fun. For that reason, even when they are supported, people often try to avoid these kinds of language gymnastics.</p>
<p>Rust tries to take an enlightened middle ground with its trait system. Rust supports adding shared functionality to existing types, but only in some <em>carefully</em> prescribed ways which avoid many of the problems with less-restrictive approaches. Rust’s trait system is a core component of the language, and you can (and should!) read more about it in the <a href="https://doc.rust-lang.org/book/ch10-02-traits.html">official documentation</a>.</p>
<p>The main takeaway for now is this: <strong>In Rust, functionality is often defined in terms of traits</strong> and in order to be effective you’ll need to <code>use</code> both the <em>traits</em> and the <em>types</em> which implement those traits (in this case <code>use wkt::TryFromWkt</code> and <code>use geo::Point</code> respectively).</p>
</div>
<h2 id="trait-or"><a class="header" href="#trait-or">Trait-or</a></h2>
<p>Another useful trait is the <a href="https://docs.rs/proj/latest/proj/trait.Transform.html"><code>Transform</code></a> trait, provided by the <code>proj</code> crate, which can be used to project geometries into a different <a href="https://en.wikipedia.org/wiki/Spatial_reference_system">coordinate reference system</a>.</p>
<p>Let’s betray latitude and longitude, technically known as <a href="https://en.wikipedia.org/wiki/World_Geodetic_System"><em>The World Geodetic System</em></a>, and transform our point in the center of the Ivanhoe reservoir to the <a href="https://www.conservation.ca.gov/cgs/rgm/state-plane-coordinate-system">California State Plane Coordinate System</a>.</p>
<header class="codeblock-header">Transform a Point with PROJ</header>
<pre><code class="language-rust"><span class="boring">use geo::Point;
</span><span class="boring">use wkt::TryFromWkt;
</span><span class="boring">
</span><span class="boring">let wkt_string = &quot;POINT(-118.265429 34.103175)&quot;;
</span><span class="boring">let mut point: Point = Point::try_from_wkt_str(wkt_string).unwrap();
</span><span class="boring">
</span>use proj::Transform;

// Transform from WGS84 to EPSG:6423
// https://epsg.io/6423 - California zone 5 (meters)
point.transform_crs_to_crs(&quot;WGS84&quot;, &quot;EPSG:6423&quot;).unwrap();

assert_eq!(point.x(), 1975508.4666086377);
assert_eq!(point.y(), 566939.9943794473);
</code></pre>
<p>If we want to export or share our results, the <code>wkt</code> crate can serialize a point’s in-memory representation back to well-known text.</p>
<header class="codeblock-header">Output WKT</header>
<pre><code class="language-rust"><span class="boring">use geo::Point;
</span><span class="boring">use wkt::TryFromWkt;
</span><span class="boring">
</span><span class="boring">let wkt_string = &quot;POINT(-118.265429 34.103175)&quot;;
</span><span class="boring">let mut point: Point = Point::try_from_wkt_str(wkt_string).unwrap();
</span><span class="boring">
</span><span class="boring">use proj::Transform;
</span><span class="boring">
</span><span class="boring">// Transform from WGS84 to EPSG:6423
</span><span class="boring">// https://epsg.io/6423 - California zone 5 (meters)
</span><span class="boring">point.transform_crs_to_crs(&quot;WGS84&quot;, &quot;EPSG:6423&quot;).unwrap();
</span><span class="boring">
</span>use wkt::ToWkt;
let wkt_output = point.wkt_string();

assert_eq!(wkt_output, &quot;POINT(1975508.4666086377 566939.9943794473)&quot;);
</code></pre>
<h3 id="connect-the-dots"><a class="header" href="#connect-the-dots">Connect the Dots</a></h3>
<p>Projecting a single point is simple enough. Let’s try something a little more interesting.</p>
<p><img src="images/ivanhoe-outline.png" alt="Polygon around the Ivanhoe reservoir in Los Angeles" /></p>
<p>People often say that the best way to learn is by making a mistake, so follow along as we do exactly that when calculating the area of this reservoir.</p>
<header class="codeblock-header">Compute Area the Wrong Way</header>
<pre><code class="language-rust">use geo::Polygon;
use wkt::TryFromWkt;
use geo::algorithm::area::Area;

let wkt_polygon = &quot;POLYGON((-118.2662232 34.1038592,-118.2662339 34.1023485,-118.2639303 34.1023235,-118.2649125 34.1038878))&quot;;
let mut polygon: Polygon = Polygon::try_from_wkt_str(wkt_polygon).unwrap();

// 🤔 That's a suspiciously small number for so much water.
assert_eq!(polygon.unsigned_area(), 0.000002779367475015937);
</code></pre>
<p>Ivanhoe reservoir is large enough to hold over 400,000 <a href="https://en.wikipedia.org/wiki/Shade_balls">shade balls</a>, so any area measurement that begins with <code>0.00000...</code> is highly suspect. Because our polygon was described in degrees (unprojected coordinates), the units of area we just computed are in “square degrees” which is not a very useful measurement. A degree near the North Pole is very different from a degree near the equator (and not just in terms of temperature).</p>
<p>To get a reasonable result, we should first project the polygon to a euclidean coordinate reference system that is suitable for Los Angeles.</p>
<header class="codeblock-header">Compute Area the Right Way</header>
<pre><code class="language-rust"><span class="boring">use geo::Polygon;
</span><span class="boring">use wkt::TryFromWkt;
</span><span class="boring">use geo::algorithm::area::Area;
</span><span class="boring">
</span><span class="boring">let wkt_polygon = &quot;POLYGON((-118.2662232 34.1038592,-118.2662339 34.1023485,-118.2639303 34.1023235,-118.2649125 34.1038878))&quot;;
</span><span class="boring">let mut polygon: Polygon = Polygon::try_from_wkt_str(wkt_polygon).unwrap();
</span><span class="boring">
</span>use proj::Transform;
// Transform from WGS84 to EPSG:6423
// https://epsg.io/6423 - California zone 5 (meters)
polygon.transform_crs_to_crs(&quot;WGS84&quot;, &quot;EPSG:6423&quot;).unwrap();

// Now we can get a useful &quot;square meters&quot; measurement.
assert_eq!(polygon.unsigned_area().round(), 28447.0);
</code></pre>
<p>Notice that we can transform this polygon the same way we previously transformed a single point. Now we know that approximately 28.4k square meters are required to hold 400k floating spheres in one small spot on the floating (slightly smooshed) sphere we call home, and we’ve solved a story problem that we were never even asked.</p>
<h2 id="working-with-what-youve-got"><a class="header" href="#working-with-what-youve-got">Working with What You’ve Got</a></h2>
<p>That’s a quick look at some of the basics of working with geometry in Rust. Next, we’ll take a look at how to use file formats like CSV and GeoJSON that support <em>features</em> to go beyond just the shape of things.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="feature-creek.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="feature-creek.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
